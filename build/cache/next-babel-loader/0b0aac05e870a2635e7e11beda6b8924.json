{"ast":null,"code":"import _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _parseInt from \"@babel/runtime-corejs2/core-js/parse-int\";\nimport React from \"react\";\n// data.js\nimport Cookies from 'js-cookie';\nimport { createContext, useReducer } from \"react\"; // 创建 context\n\nexport const DataContext = createContext({}); // 定义 参数\n// let state = {\n//     id: 1234,\n//     token: Cookies.get('token') || '',\n//     user: Cookies.get('user') ? JSON.parse(Cookies.get('user')) : '',\n//     bis: Cookies.get('bis') ? JSON.parse(Cookies.get('bis')) : '',\n//     loading: false,\n// };\n\nconst initState = cookies => {\n  let state = {\n    id: 1234,\n    token: '',\n    user: '',\n    bis: '',\n    loading: false\n  };\n  cookies.token && (state.token = cookies.token);\n  cookies.user && (state.user = JSON.parse(cookies.user));\n  cookies.bis && (state.bis = JSON.parse(cookies.bis));\n  return state;\n}; // reducer\n\n\nexport const UPDATE_ID = \"UPDATE_ID\";\nexport const LOGIN = \"LOGIN\";\nexport const LOGOUT = \"LOGOUT\";\nexport const INIT_COOKIES = \"INIT_COOKIES\";\n\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case UPDATE_ID:\n      state.id += _parseInt(action.id) || 1;\n      return _objectSpread({}, state);\n      break;\n\n    case LOGIN:\n      state.token = action.token;\n      state.user = action.user || '';\n      state.bis = action.bis || '';\n      Cookies.set('token', action.token, {\n        expires: 7\n      }); // 失效时间7天\n\n      !action.user ? Cookies.remove('user', {\n        path: ''\n      }) : Cookies.set('user', _JSON$stringify(action.user), {\n        expires: 7\n      }); // 对整个站点有效\n\n      !action.bis ? Cookies.remove('bis', {\n        path: ''\n      }) : Cookies.set('bis', _JSON$stringify(action.bis), {\n        expires: 7\n      }); //对当前路径有效\n\n      return _objectSpread({}, state);\n      break;\n\n    case LOGOUT:\n      state.token = '';\n      state.user = '';\n      state.bis = '';\n      Cookies.remove('token', {\n        path: ''\n      }); // fail!\n\n      Cookies.remove('user', {\n        path: ''\n      }); // removed!\n\n      Cookies.remove('bis', {\n        path: ''\n      }); // removed!\n\n      return _objectSpread({}, state);\n      break;\n\n    case INIT_COOKIES:\n      if (action.cookies) {\n        let objArr = _Object$keys(action.cookies);\n\n        objArr.forEach((value, indx) => {\n          Cookies.set(value, action.cookies[value], {\n            expires: 7\n          });\n        });\n      }\n\n      return;\n      break;\n\n    default:\n      return state;\n  }\n};\n/**\r\n * 创建一个 Data 组件\r\n * Data 组件包裹的所有子组件都可以通过调用 DataContext 访问到 value\r\n */\n\n\nexport const Data = props => {\n  const [data, dispatch] = useReducer(reducer, initState(props.cookies));\n  return React.createElement(DataContext.Provider, {\n    value: {\n      data,\n      dispatch\n    }\n  }, props.children);\n};","map":{"version":3,"sources":["E:\\提莫淘\\提莫淘客\\demo\\next-react\\store\\data.js"],"names":["Cookies","createContext","useReducer","DataContext","initState","cookies","state","id","token","user","bis","loading","JSON","parse","UPDATE_ID","LOGIN","LOGOUT","INIT_COOKIES","reducer","action","type","set","expires","remove","path","objArr","forEach","value","indx","Data","props","data","dispatch","children"],"mappings":"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","sourcesContent":["// data.js\r\nimport Cookies from 'js-cookie';\r\nimport { createContext, useReducer } from \"react\";\r\n\r\n// 创建 context\r\nexport const DataContext = createContext({});\r\n\r\n// 定义 参数\r\n// let state = {\r\n//     id: 1234,\r\n//     token: Cookies.get('token') || '',\r\n//     user: Cookies.get('user') ? JSON.parse(Cookies.get('user')) : '',\r\n//     bis: Cookies.get('bis') ? JSON.parse(Cookies.get('bis')) : '',\r\n//     loading: false,\r\n// };\r\n\r\nconst initState = (cookies) => {\r\n    let state = {\r\n        id: 1234,\r\n        token: '',\r\n        user: '',\r\n        bis: '',\r\n        loading: false\r\n    };\r\n    cookies.token && (state.token = cookies.token);\r\n    cookies.user && (state.user = JSON.parse(cookies.user));\r\n    cookies.bis && (state.bis = JSON.parse(cookies.bis));\r\n    return state;\r\n}\r\n\r\n\r\n// reducer\r\nexport const UPDATE_ID = \"UPDATE_ID\";\r\nexport const LOGIN = \"LOGIN\";\r\nexport const LOGOUT = \"LOGOUT\";\r\nexport const INIT_COOKIES = \"INIT_COOKIES\";\r\n\r\n\r\nconst reducer = (state, action) => {\r\n    switch(action.type) {\r\n        case UPDATE_ID:\r\n            state.id += (parseInt(action.id) || 1);\r\n            return { ...state }\r\n            break;\r\n        case LOGIN:\r\n            state.token = action.token;\r\n            state.user = action.user || '';\r\n            state.bis = action.bis || '';\r\n            Cookies.set('token', action.token, { expires: 7 });            // 失效时间7天\r\n            !action.user ?  Cookies.remove('user', {path: '' }) : Cookies.set('user', JSON.stringify(action.user), { expires: 7 });      // 对整个站点有效\r\n            !action.bis ? Cookies.remove('bis', {path: '' }) : Cookies.set('bis', JSON.stringify(action.bis), { expires: 7});   //对当前路径有效\r\n\r\n            return { ...state }\r\n            break;\r\n        case LOGOUT:\r\n            state.token = '';\r\n            state.user = '';\r\n            state.bis = '';\r\n            Cookies.remove('token', {path: '' }); // fail!\r\n            Cookies.remove('user', {path: '' }); // removed!\r\n            Cookies.remove('bis', {path: '' }); // removed!\r\n            return { ...state };\r\n            break;\r\n        case INIT_COOKIES:\r\n            if(action.cookies) {\r\n                let objArr = Object.keys(action.cookies);\r\n                objArr.forEach((value, indx) => {\r\n                    Cookies.set(value, action.cookies[value], { expires: 7 });\r\n                });\r\n            }\r\n            return\r\n            break;\r\n        default:\r\n            return state\r\n    }\r\n}\r\n\r\n/**\r\n * 创建一个 Data 组件\r\n * Data 组件包裹的所有子组件都可以通过调用 DataContext 访问到 value\r\n */\r\nexport const Data = props => {\r\n\r\n    const [ data, dispatch ] = useReducer(reducer, initState(props.cookies));\r\n    return (\r\n        <DataContext.Provider value={{ data, dispatch }}>\r\n            {props.children}\r\n        </DataContext.Provider>\r\n    );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}